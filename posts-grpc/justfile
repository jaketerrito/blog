build:
    docker compose build development

up: up-db up-server

up-db:
    docker compose up -d db

up-server:
    docker compose down db

down: down-server down-db

down-server:
    docker compose down development

down-db:
    docker compose down db

logs:
    docker compose logs -f development

lint:
	docker compose run --rm development ruff check .

format:
    docker compose run --rm development ruff format .

format-check:
    docker compose run --rm development ruff format . --check

test: build up-db
    docker compose run --rm development pytest --cov=src --cov-report=xml:coverage.xml

proto:
    docker compose run --rm -v $(pwd)/../proto:/proto development python -m grpc_tools.protoc -Iproto=/proto/posts/v1 --python_out=/app/src --pyi_out=/app/src --grpc_python_out=/app/src /proto/posts/v1/posts.proto